<!doctype html><html lang=en><head><meta charset=utf-8><title>一门纯粹的编程语言：PureLang</title><meta name=description content="一门纯粹的编程语言：PureLang"><meta name=author content="Yubao Liu"><meta name=viewport content="width=device-width,initial-scale=1"><noscript><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel=stylesheet type=text/css><link rel=stylesheet href=/css/fonts.css></noscript><style type=text/css media=screen>/*!Pure v3.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/pure-css/pure/blob/master/LICENSE*//*!normalize.css v | MIT License | https://necolas.github.io/normalize.css/
Copyright (c) Nicolas Gallagher and Jonathan Neal*//*!normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css*/html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}html{font-family:sans-serif}.hidden,[hidden]{display:none !important}.pure-img{max-width:100%;height:auto;display:block}</style><style type=text/css media=screen>/*!Pure v3.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/pure-css/pure/blob/master/LICENSE*/.pure-menu{box-sizing:border-box}.pure-menu-fixed{position:fixed;left:0;top:0;z-index:3}.pure-menu-item,.pure-menu-list{position:relative}.pure-menu-list{list-style:none;margin:0;padding:0}.pure-menu-item{padding:0;margin:0;height:100%}.pure-menu-heading,.pure-menu-link{display:block;text-decoration:none;white-space:nowrap}.pure-menu-horizontal{width:100%;white-space:nowrap}.pure-menu-horizontal .pure-menu-list{display:inline-block}.pure-menu-horizontal .pure-menu-heading,.pure-menu-horizontal .pure-menu-item,.pure-menu-horizontal .pure-menu-separator{display:inline-block;vertical-align:middle}.pure-menu-item .pure-menu-item{display:block}.pure-menu-children{display:none;position:absolute;left:100%;top:0;margin:0;padding:0;z-index:3}.pure-menu-horizontal .pure-menu-children{left:0;top:auto;width:inherit}.pure-menu-active>.pure-menu-children,.pure-menu-allow-hover:hover>.pure-menu-children{display:block;position:absolute}.pure-menu-has-children>.pure-menu-link:after{padding-left:.5em;content:"\25B8";font-size:small}.pure-menu-horizontal .pure-menu-has-children>.pure-menu-link:after{content:"\25BE"}.pure-menu-scrollable{overflow-y:scroll;overflow-x:hidden}.pure-menu-scrollable .pure-menu-list{display:block}.pure-menu-horizontal.pure-menu-scrollable .pure-menu-list{display:inline-block}.pure-menu-horizontal.pure-menu-scrollable{white-space:nowrap;overflow-y:hidden;overflow-x:auto;padding:.5em 0}.pure-menu-horizontal .pure-menu-children .pure-menu-separator,.pure-menu-separator{background-color:#ccc;height:1px;margin:.3em 0}.pure-menu-horizontal .pure-menu-separator{width:1px;height:1.3em;margin:0 .3em}.pure-menu-horizontal .pure-menu-children .pure-menu-separator{display:block;width:auto}.pure-menu-heading{text-transform:uppercase;color:#565d64}.pure-menu-link{color:#777}.pure-menu-children{background-color:#fff}.pure-menu-heading,.pure-menu-link{padding:.5em 1em}.pure-menu-disabled{opacity:.5}.pure-menu-disabled .pure-menu-link:hover{background-color:transparent;cursor:default}.pure-menu-active>.pure-menu-link,.pure-menu-link:focus,.pure-menu-link:hover{background-color:#eee}.pure-menu-selected>.pure-menu-link,.pure-menu-selected>.pure-menu-link:visited{color:#000}</style><style type=text/css media=screen>/*!Pure v3.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/pure-css/pure/blob/master/LICENSE*/.pure-g{display:flex;flex-flow:row wrap;align-content:flex-start}.pure-u{display:inline-block;vertical-align:top}.pure-u-1,.pure-u-1-1,.pure-u-1-12,.pure-u-1-2,.pure-u-1-24,.pure-u-1-3,.pure-u-1-4,.pure-u-1-5,.pure-u-1-6,.pure-u-1-8,.pure-u-10-24,.pure-u-11-12,.pure-u-11-24,.pure-u-12-24,.pure-u-13-24,.pure-u-14-24,.pure-u-15-24,.pure-u-16-24,.pure-u-17-24,.pure-u-18-24,.pure-u-19-24,.pure-u-2-24,.pure-u-2-3,.pure-u-2-5,.pure-u-20-24,.pure-u-21-24,.pure-u-22-24,.pure-u-23-24,.pure-u-24-24,.pure-u-3-24,.pure-u-3-4,.pure-u-3-5,.pure-u-3-8,.pure-u-4-24,.pure-u-4-5,.pure-u-5-12,.pure-u-5-24,.pure-u-5-5,.pure-u-5-6,.pure-u-5-8,.pure-u-6-24,.pure-u-7-12,.pure-u-7-24,.pure-u-7-8,.pure-u-8-24,.pure-u-9-24{display:inline-block;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-1-24{width:4.1667%}.pure-u-1-12,.pure-u-2-24{width:8.3333%}.pure-u-1-8,.pure-u-3-24{width:12.5%}.pure-u-1-6,.pure-u-4-24{width:16.6667%}.pure-u-1-5{width:20%}.pure-u-5-24{width:20.8333%}.pure-u-1-4,.pure-u-6-24{width:25%}.pure-u-7-24{width:29.1667%}.pure-u-1-3,.pure-u-8-24{width:33.3333%}.pure-u-3-8,.pure-u-9-24{width:37.5%}.pure-u-2-5{width:40%}.pure-u-10-24,.pure-u-5-12{width:41.6667%}.pure-u-11-24{width:45.8333%}.pure-u-1-2,.pure-u-12-24{width:50%}.pure-u-13-24{width:54.1667%}.pure-u-14-24,.pure-u-7-12{width:58.3333%}.pure-u-3-5{width:60%}.pure-u-15-24,.pure-u-5-8{width:62.5%}.pure-u-16-24,.pure-u-2-3{width:66.6667%}.pure-u-17-24{width:70.8333%}.pure-u-18-24,.pure-u-3-4{width:75%}.pure-u-19-24{width:79.1667%}.pure-u-4-5{width:80%}.pure-u-20-24,.pure-u-5-6{width:83.3333%}.pure-u-21-24,.pure-u-7-8{width:87.5%}.pure-u-11-12,.pure-u-22-24{width:91.6667%}.pure-u-23-24{width:95.8333%}.pure-u-1,.pure-u-1-1,.pure-u-24-24,.pure-u-5-5{width:100%}</style><style type=text/css media=screen>/*!Pure v3.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/pure-css/pure/blob/master/LICENSE*/.pure-table{border-collapse:collapse;border-spacing:0;empty-cells:show;border:1px solid #cbcbcb}.pure-table caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center}.pure-table td,.pure-table th{border-left:1px solid #cbcbcb;border-width:0 0 0 1px;font-size:inherit;margin:0;overflow:visible;padding:.5em 1em}.pure-table thead{background-color:#e0e0e0;color:#000;text-align:left;vertical-align:bottom}.pure-table td{background-color:transparent}.pure-table-odd td{background-color:#f2f2f2}.pure-table-striped tr:nth-child(2n-1) td{background-color:#f2f2f2}.pure-table-bordered td{border-bottom:1px solid #cbcbcb}.pure-table-bordered tbody>tr:last-child>td{border-bottom-width:0}.pure-table-horizontal td,.pure-table-horizontal th{border-width:0 0 1px;border-bottom:1px solid #cbcbcb}.pure-table-horizontal tbody>tr:last-child>td{border-bottom-width:0}</style><style type=text/css media=screen>/*!Pure v1.0.0
Copyright 2013 Yahoo!
Licensed under the BSD License.
https://github.com/yahoo/pure/blob/master/LICENSE.md*/@media screen and (min-width:35.5em){.pure-u-sm-1,.pure-u-sm-1-1,.pure-u-sm-1-12,.pure-u-sm-1-2,.pure-u-sm-1-24,.pure-u-sm-1-3,.pure-u-sm-1-4,.pure-u-sm-1-5,.pure-u-sm-1-6,.pure-u-sm-1-8,.pure-u-sm-10-24,.pure-u-sm-11-12,.pure-u-sm-11-24,.pure-u-sm-12-24,.pure-u-sm-13-24,.pure-u-sm-14-24,.pure-u-sm-15-24,.pure-u-sm-16-24,.pure-u-sm-17-24,.pure-u-sm-18-24,.pure-u-sm-19-24,.pure-u-sm-2-24,.pure-u-sm-2-3,.pure-u-sm-2-5,.pure-u-sm-20-24,.pure-u-sm-21-24,.pure-u-sm-22-24,.pure-u-sm-23-24,.pure-u-sm-24-24,.pure-u-sm-3-24,.pure-u-sm-3-4,.pure-u-sm-3-5,.pure-u-sm-3-8,.pure-u-sm-4-24,.pure-u-sm-4-5,.pure-u-sm-5-12,.pure-u-sm-5-24,.pure-u-sm-5-5,.pure-u-sm-5-6,.pure-u-sm-5-8,.pure-u-sm-6-24,.pure-u-sm-7-12,.pure-u-sm-7-24,.pure-u-sm-7-8,.pure-u-sm-8-24,.pure-u-sm-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-sm-1-24{width:4.1667%}.pure-u-sm-1-12,.pure-u-sm-2-24{width:8.3333%}.pure-u-sm-1-8,.pure-u-sm-3-24{width:12.5%}.pure-u-sm-1-6,.pure-u-sm-4-24{width:16.6667%}.pure-u-sm-1-5{width:20%}.pure-u-sm-5-24{width:20.8333%}.pure-u-sm-1-4,.pure-u-sm-6-24{width:25%}.pure-u-sm-7-24{width:29.1667%}.pure-u-sm-1-3,.pure-u-sm-8-24{width:33.3333%}.pure-u-sm-3-8,.pure-u-sm-9-24{width:37.5%}.pure-u-sm-2-5{width:40%}.pure-u-sm-10-24,.pure-u-sm-5-12{width:41.6667%}.pure-u-sm-11-24{width:45.8333%}.pure-u-sm-1-2,.pure-u-sm-12-24{width:50%}.pure-u-sm-13-24{width:54.1667%}.pure-u-sm-14-24,.pure-u-sm-7-12{width:58.3333%}.pure-u-sm-3-5{width:60%}.pure-u-sm-15-24,.pure-u-sm-5-8{width:62.5%}.pure-u-sm-16-24,.pure-u-sm-2-3{width:66.6667%}.pure-u-sm-17-24{width:70.8333%}.pure-u-sm-18-24,.pure-u-sm-3-4{width:75%}.pure-u-sm-19-24{width:79.1667%}.pure-u-sm-4-5{width:80%}.pure-u-sm-20-24,.pure-u-sm-5-6{width:83.3333%}.pure-u-sm-21-24,.pure-u-sm-7-8{width:87.5%}.pure-u-sm-11-12,.pure-u-sm-22-24{width:91.6667%}.pure-u-sm-23-24{width:95.8333%}.pure-u-sm-1,.pure-u-sm-1-1,.pure-u-sm-24-24,.pure-u-sm-5-5{width:100%}}@media screen and (min-width:48em){.pure-u-md-1,.pure-u-md-1-1,.pure-u-md-1-12,.pure-u-md-1-2,.pure-u-md-1-24,.pure-u-md-1-3,.pure-u-md-1-4,.pure-u-md-1-5,.pure-u-md-1-6,.pure-u-md-1-8,.pure-u-md-10-24,.pure-u-md-11-12,.pure-u-md-11-24,.pure-u-md-12-24,.pure-u-md-13-24,.pure-u-md-14-24,.pure-u-md-15-24,.pure-u-md-16-24,.pure-u-md-17-24,.pure-u-md-18-24,.pure-u-md-19-24,.pure-u-md-2-24,.pure-u-md-2-3,.pure-u-md-2-5,.pure-u-md-20-24,.pure-u-md-21-24,.pure-u-md-22-24,.pure-u-md-23-24,.pure-u-md-24-24,.pure-u-md-3-24,.pure-u-md-3-4,.pure-u-md-3-5,.pure-u-md-3-8,.pure-u-md-4-24,.pure-u-md-4-5,.pure-u-md-5-12,.pure-u-md-5-24,.pure-u-md-5-5,.pure-u-md-5-6,.pure-u-md-5-8,.pure-u-md-6-24,.pure-u-md-7-12,.pure-u-md-7-24,.pure-u-md-7-8,.pure-u-md-8-24,.pure-u-md-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-md-1-24{width:4.1667%}.pure-u-md-1-12,.pure-u-md-2-24{width:8.3333%}.pure-u-md-1-8,.pure-u-md-3-24{width:12.5%}.pure-u-md-1-6,.pure-u-md-4-24{width:16.6667%}.pure-u-md-1-5{width:20%}.pure-u-md-5-24{width:20.8333%}.pure-u-md-1-4,.pure-u-md-6-24{width:25%}.pure-u-md-7-24{width:29.1667%}.pure-u-md-1-3,.pure-u-md-8-24{width:33.3333%}.pure-u-md-3-8,.pure-u-md-9-24{width:37.5%}.pure-u-md-2-5{width:40%}.pure-u-md-10-24,.pure-u-md-5-12{width:41.6667%}.pure-u-md-11-24{width:45.8333%}.pure-u-md-1-2,.pure-u-md-12-24{width:50%}.pure-u-md-13-24{width:54.1667%}.pure-u-md-14-24,.pure-u-md-7-12{width:58.3333%}.pure-u-md-3-5{width:60%}.pure-u-md-15-24,.pure-u-md-5-8{width:62.5%}.pure-u-md-16-24,.pure-u-md-2-3{width:66.6667%}.pure-u-md-17-24{width:70.8333%}.pure-u-md-18-24,.pure-u-md-3-4{width:75%}.pure-u-md-19-24{width:79.1667%}.pure-u-md-4-5{width:80%}.pure-u-md-20-24,.pure-u-md-5-6{width:83.3333%}.pure-u-md-21-24,.pure-u-md-7-8{width:87.5%}.pure-u-md-11-12,.pure-u-md-22-24{width:91.6667%}.pure-u-md-23-24{width:95.8333%}.pure-u-md-1,.pure-u-md-1-1,.pure-u-md-24-24,.pure-u-md-5-5{width:100%}}@media screen and (min-width:64em){.pure-u-lg-1,.pure-u-lg-1-1,.pure-u-lg-1-12,.pure-u-lg-1-2,.pure-u-lg-1-24,.pure-u-lg-1-3,.pure-u-lg-1-4,.pure-u-lg-1-5,.pure-u-lg-1-6,.pure-u-lg-1-8,.pure-u-lg-10-24,.pure-u-lg-11-12,.pure-u-lg-11-24,.pure-u-lg-12-24,.pure-u-lg-13-24,.pure-u-lg-14-24,.pure-u-lg-15-24,.pure-u-lg-16-24,.pure-u-lg-17-24,.pure-u-lg-18-24,.pure-u-lg-19-24,.pure-u-lg-2-24,.pure-u-lg-2-3,.pure-u-lg-2-5,.pure-u-lg-20-24,.pure-u-lg-21-24,.pure-u-lg-22-24,.pure-u-lg-23-24,.pure-u-lg-24-24,.pure-u-lg-3-24,.pure-u-lg-3-4,.pure-u-lg-3-5,.pure-u-lg-3-8,.pure-u-lg-4-24,.pure-u-lg-4-5,.pure-u-lg-5-12,.pure-u-lg-5-24,.pure-u-lg-5-5,.pure-u-lg-5-6,.pure-u-lg-5-8,.pure-u-lg-6-24,.pure-u-lg-7-12,.pure-u-lg-7-24,.pure-u-lg-7-8,.pure-u-lg-8-24,.pure-u-lg-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-lg-1-24{width:4.1667%}.pure-u-lg-1-12,.pure-u-lg-2-24{width:8.3333%}.pure-u-lg-1-8,.pure-u-lg-3-24{width:12.5%}.pure-u-lg-1-6,.pure-u-lg-4-24{width:16.6667%}.pure-u-lg-1-5{width:20%}.pure-u-lg-5-24{width:20.8333%}.pure-u-lg-1-4,.pure-u-lg-6-24{width:25%}.pure-u-lg-7-24{width:29.1667%}.pure-u-lg-1-3,.pure-u-lg-8-24{width:33.3333%}.pure-u-lg-3-8,.pure-u-lg-9-24{width:37.5%}.pure-u-lg-2-5{width:40%}.pure-u-lg-10-24,.pure-u-lg-5-12{width:41.6667%}.pure-u-lg-11-24{width:45.8333%}.pure-u-lg-1-2,.pure-u-lg-12-24{width:50%}.pure-u-lg-13-24{width:54.1667%}.pure-u-lg-14-24,.pure-u-lg-7-12{width:58.3333%}.pure-u-lg-3-5{width:60%}.pure-u-lg-15-24,.pure-u-lg-5-8{width:62.5%}.pure-u-lg-16-24,.pure-u-lg-2-3{width:66.6667%}.pure-u-lg-17-24{width:70.8333%}.pure-u-lg-18-24,.pure-u-lg-3-4{width:75%}.pure-u-lg-19-24{width:79.1667%}.pure-u-lg-4-5{width:80%}.pure-u-lg-20-24,.pure-u-lg-5-6{width:83.3333%}.pure-u-lg-21-24,.pure-u-lg-7-8{width:87.5%}.pure-u-lg-11-12,.pure-u-lg-22-24{width:91.6667%}.pure-u-lg-23-24{width:95.8333%}.pure-u-lg-1,.pure-u-lg-1-1,.pure-u-lg-24-24,.pure-u-lg-5-5{width:100%}}@media screen and (min-width:80em){.pure-u-xl-1,.pure-u-xl-1-1,.pure-u-xl-1-12,.pure-u-xl-1-2,.pure-u-xl-1-24,.pure-u-xl-1-3,.pure-u-xl-1-4,.pure-u-xl-1-5,.pure-u-xl-1-6,.pure-u-xl-1-8,.pure-u-xl-10-24,.pure-u-xl-11-12,.pure-u-xl-11-24,.pure-u-xl-12-24,.pure-u-xl-13-24,.pure-u-xl-14-24,.pure-u-xl-15-24,.pure-u-xl-16-24,.pure-u-xl-17-24,.pure-u-xl-18-24,.pure-u-xl-19-24,.pure-u-xl-2-24,.pure-u-xl-2-3,.pure-u-xl-2-5,.pure-u-xl-20-24,.pure-u-xl-21-24,.pure-u-xl-22-24,.pure-u-xl-23-24,.pure-u-xl-24-24,.pure-u-xl-3-24,.pure-u-xl-3-4,.pure-u-xl-3-5,.pure-u-xl-3-8,.pure-u-xl-4-24,.pure-u-xl-4-5,.pure-u-xl-5-12,.pure-u-xl-5-24,.pure-u-xl-5-5,.pure-u-xl-5-6,.pure-u-xl-5-8,.pure-u-xl-6-24,.pure-u-xl-7-12,.pure-u-xl-7-24,.pure-u-xl-7-8,.pure-u-xl-8-24,.pure-u-xl-9-24{display:inline-block;zoom:1;letter-spacing:normal;word-spacing:normal;vertical-align:top;text-rendering:auto}.pure-u-xl-1-24{width:4.1667%}.pure-u-xl-1-12,.pure-u-xl-2-24{width:8.3333%}.pure-u-xl-1-8,.pure-u-xl-3-24{width:12.5%}.pure-u-xl-1-6,.pure-u-xl-4-24{width:16.6667%}.pure-u-xl-1-5{width:20%}.pure-u-xl-5-24{width:20.8333%}.pure-u-xl-1-4,.pure-u-xl-6-24{width:25%}.pure-u-xl-7-24{width:29.1667%}.pure-u-xl-1-3,.pure-u-xl-8-24{width:33.3333%}.pure-u-xl-3-8,.pure-u-xl-9-24{width:37.5%}.pure-u-xl-2-5{width:40%}.pure-u-xl-10-24,.pure-u-xl-5-12{width:41.6667%}.pure-u-xl-11-24{width:45.8333%}.pure-u-xl-1-2,.pure-u-xl-12-24{width:50%}.pure-u-xl-13-24{width:54.1667%}.pure-u-xl-14-24,.pure-u-xl-7-12{width:58.3333%}.pure-u-xl-3-5{width:60%}.pure-u-xl-15-24,.pure-u-xl-5-8{width:62.5%}.pure-u-xl-16-24,.pure-u-xl-2-3{width:66.6667%}.pure-u-xl-17-24{width:70.8333%}.pure-u-xl-18-24,.pure-u-xl-3-4{width:75%}.pure-u-xl-19-24{width:79.1667%}.pure-u-xl-4-5{width:80%}.pure-u-xl-20-24,.pure-u-xl-5-6{width:83.3333%}.pure-u-xl-21-24,.pure-u-xl-7-8{width:87.5%}.pure-u-xl-11-12,.pure-u-xl-22-24{width:91.6667%}.pure-u-xl-23-24{width:95.8333%}.pure-u-xl-1,.pure-u-xl-1-1,.pure-u-xl-24-24,.pure-u-xl-5-5{width:100%}}</style><style type=text/css media=screen>:root{--color:#484848;--color-footnote:#575757;--color-footer-content:#bbb;--background-color:rgb(252, 252, 252);--background-color-code:rgb(240, 240, 240);--background-color-toggle-content:rgb(249, 249, 249);--link-color:#c05b4d;--link-color-hover:#a5473a;--list-link-color:#336699;--border-navbar-and-footer:#e3e3e3}</style><style type=text/css media=screen>html{min-height:100%;width:100%;position:relative}body{background-color:#fcfcfc;background-color:var(--background-color);color:#484848;color:var(--color)}a{text-decoration:none}kbd,pre,code,samp{background-color:#f0f0f0;background-color:var(--background-color-code)}.nav-menu{margin-top:5px;padding-bottom:5px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#e3e3e3;border-bottom-color:var(--border-navbar-and-footer)}.pure-menu-heading{text-transform:none;font-size:large}.pure-menu-link:hover{background-color:unset}.header{text-align:left;color:#484848;color:var(--color);margin-bottom:.5em}.header ul li{height:auto}.header ul li a{font-weight:700;color:#484848;color:var(--color);font-family:source sans pro,helveticaneue,helvetica neue,Helvetica,Arial,sans-serif}.header{font-weight:700;color:#484848;color:var(--color);font-family:source sans pro,helveticaneue,helvetica neue,Helvetica,Arial,sans-serif}.site-title{color:#484848;color:var(--color);text-transform:none;font-weight:400;font-family:source sans pro,helveticaneue,helvetica neue,Helvetica,Arial,sans-serif}.pull-right{float:right}.posts-name{text-transform:capitalize;font-weight:700;padding-left:1em;margin-top:1em;font-family:source sans pro,helveticaneue,helvetica neue,Helvetica,Arial,sans-serif}.posts{font-family:verdana,arial,helvetica,sans-serif;list-style-type:none;padding-left:1em}.posts li p{margin-top:0}.posts li{margin-bottom:1em}.posts li>a{color:#369;color:var(--list-link-color);text-decoration:none}.post-list{font-size:large}.footnote{font-family:verdana,arial,helvetica,sans-serif;color:#575757;color:var(--color-footnote);font-size:.75em;margin-bottom:0}.footnote a{color:#575757;color:var(--color-footnote)}.footnote a:hover{text-decoration:underline;color:#369;color:var(--list-link-color)}.footer{position:absolute;z-index:2;height:auto;width:100%;bottom:0}.footer-content{border-top-width:1px;border-top-style:solid;border-top-color:#e3e3e3;border-top:1px solid var(--border-navbar-and-footer);font-size:80%;color:#bbb;color:var(--color-footer-content)}.footer-content a{color:#575757;color:var(--color-footnote)}.footer-content ul{height:auto;margin-top:0;margin-bottom:0;display:inline-block;padding-left:0}#TableOfContents>ul{list-style:none;margin:0;padding:0}#gototop-btn{display:inline-block}#foot-name{color:#484848;color:var(--color);text-transform:none}#foot-copyright{padding-left:1em;padding-bottom:.5em;margin:0}.post{font-family:proxima-nova,helvetica neue,Helvetica,Roboto,Arial,sans-serif;color:#484848;color:var(--color);letter-spacing:normal;padding-left:.5em}.post h1,h2,h3,h4,h5,h6{font-weight:700;letter-spacing:normal}.post-content{z-index:9;overflow:auto;padding:0;padding-bottom:3em;font-size:16px;line-height:1.4}.post-content img{max-width:100%;height:auto}.post-content pre{padding:.5em}.post a{color:#c05b4d;color:var(--link-color);text-decoration:none}.post a:hover{color:#a5473a;color:var(--link-color-hover);text-decoration:underline}.post h1{font-size:28px}.post h2{font-size:25px}.post h3{font-size:23px}.post h4{font-size:21px}.post h5{font-size:19px}.post h6{font-size:18px}.post-title{margin-top:0;margin-bottom:1em}.post-title h1{font-weight:700;font-size:39px;line-height:40px;margin-top:0;margin-bottom:0}@media screen and (max-width:768px){.desktop{display:none}.mobile{display:block}#toggle-btn{display:inline-block;float:right;padding:.5em 1em;text-decoration:none;color:#484848;color:var(--color);font-weight:700}#toggle-content li{clear:both;height:auto;background-color:#f9f9f9;background-color:var(--background-color-toggle-content)}#toggle-home{display:inline-block}}@media screen and (min-width:769px){.mobile{display:none}.desktop{display:block}}</style><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon></head><body><div class="header pure-g"><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div><div class="pure-u-11-12 pure-u-md-20-24 pure-u-lg-7-12"><div class="desktop pure-menu pure-menu-horizontal nav-menu"><a href=/ class="site-title pure-menu-heading">随记</a><ul class="pure-menu-list pull-right"><li class=pure-menu-item><a href=/categories/development/ class=pure-menu-link>Development</a></li><li class=pure-menu-item><a href=/categories/os/ class=pure-menu-link>OS</a></li><li class=pure-menu-item><a href=/categories/reading/ class=pure-menu-link>Reading</a></li><li class=pure-menu-item><a href=/about/ class=pure-menu-link>About</a></li></ul></div><div class="mobile pure-menu nav-menu"><a href=/ class="site-title pure-menu-heading" id=toggle-home>随记</a>
<a href=# id=toggle-btn>&#9776;</a><ul class=pure-menu-list id=toggle-content style=display:none><li class=pure-menu-item><a href=/categories/development/ class=pure-menu-link>Development</a></li><li class=pure-menu-item><a href=/categories/os/ class=pure-menu-link>OS</a></li><li class=pure-menu-item><a href=/categories/reading/ class=pure-menu-link>Reading</a></li><li class=pure-menu-item><a href=/about class=pure-menu-link>About</a></li></ul></div></div><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div></div><div class=pure-g><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div><div class="pure-u-11-12 pure-u-md-20-24 pure-u-lg-7-12"><div class=post><div class=post-title><p class=footnote><time datetime="2025-07-13 22:00:00 +0800 CST">2025-07-13
</time>|
tags: [ <a href=/tags/compiler>Compiler</a> <a href=/tags/peg>PEG</a> ]
categories: [ <a href=/categories/development>Development</a> ]</p><h1>一门纯粹的编程语言：PureLang</h1></div><div class=post-content><nav id=TableOfContents><ul><li><a href=#引子>引子</a></li><li><a href=#目标>目标</a></li><li><a href=#purelang>PureLang</a><ul><li><a href=#语法>语法</a></li><li><a href=#类型>类型</a></li><li><a href=#操作符>操作符</a></li><li><a href=#惰性求值>惰性求值</a></li><li><a href=#编译>编译</a></li><li><a href=#内存管理>内存管理</a></li><li><a href=#lsp>LSP</a></li></ul></li><li><a href=#结语>结语</a></li></ul></nav><blockquote><p>「一个人能力有大小，但只要有这点精神，就是一个高尚的人，一个纯粹的人，一个有道德的人，一个脱离了低级趣味的人，一个有益于人民的人。」 —— 《纪念白求恩》</p></blockquote><h2 id=引子>引子</h2><p>如同剑客需要一把趁手的绝世好剑，很多程序员也在毕生企盼一门如意的完美编程语言，很可惜，这种语言至今没有出现：</p><ol><li><p><a href=https://pragprog.com/titles/btlang/seven-languages-in-seven-weeks/>Seven languages in seven weeks</a> 和 <a href=https://pragprog.com/titles/7lang/seven-more-languages-in-seven-weeks/>Seven more languages in seven weeks</a> 挑了 14 种小众语言让大家开拓眼界；</p></li><li><p><a href=https://exploring-data.com/vis/programming-languages-influence-network/>Programming Languages Influence Network</a> 展示了影响最大的几个语言：Lisp, Smalltalk, C/Java/Pascal/C++, Haskell；</p></li><li><p><a href=./an-opinionated-history-of-programming-languages.png>An opinionated history of programming languages</a> 讲述了几个主要语言的影响力和未来命运，原文被网友吐槽得太厉害而删掉了😀；</p></li><li><p><a href=https://www.levenez.com/lang/>Computer Language History</a> 囊括了几乎所有编程语言，可以很清晰的看到语言演进的流派；</p></li><li><p><a href=https://www.swyx.io/notes-on-growing-a-language-by-guy-steele-5501>Growing a language</a> Guy Steele 关于语言设计的真知灼见非常值得拜读；</p></li><li><p>图灵奖得主 Edsger W. Dijkstra：谦卑的程序员（1972 年）（<a href=https://www.infoq.cn/article/yAIbLpwd62FXW9JiNAHI>上</a>）（<a href=https://www.infoq.cn/article/rui5MyudtsmFpHVjgIG8>下</a>）谈到形式证明应该跟程序一体，而不是先写程序再单独写证明，这个思路已经在 Idris、Lean 等语言中得到体现；</p></li><li><p><a href=https://michael.orlitzky.com/articles/greybeards_tomb%3A_the_lost_treasure_of_language_design.xhtml>The lost treasure of language design</a>， 这位暴躁老哥的编程语言大吐槽很好玩；</p></li><li><p><a href=https://hirrolot.github.io/posts/why-static-languages-suffer-from-complexity.html>Why static languages suffer from complexity</a>，很认同作者的观点：能统一编译期和运行期语法的静态强类型语言最佳。C/C++/Rust/Haskell 都是反面例子，宏、模版语法与常规语法不一致，就是所谓的二象性(biformity)；Lisp能统一但是不是静态类型语言；Java 的编译期构造语法极弱； 支持 dependent type的 Idris 统一语法了但是额外特性太多而不实用，Zig 虽然没有 dependent type 也支持统一语法了，但语言本身过于底层。</p></li><li><p><a href=https://github.com/papers-we-love/papers-we-love/blob/main/design/out-of-the-tar-pit.pdf>Out of the Tar Pit</a>，论文分析了程序的复杂性来源，提出 Functional Relational Programming 编程范式是最佳范式；</p><hr></li></ol><h2 id=目标>目标</h2><p>语言设计是个大话题，众说纷纭，这里总结一下我觉得是「好语言」的设计目标：</p><ol><li><p>从语法风格上，类 Pascal / C 风格的语言接近人类自然语言和数学语言，比 Lisp、Smalltalk、APL、Forth 这类特立独行的语言要更受欢迎；</p></li><li><p>从表达能力上，简洁又表达能力强的语言是大家喜爱的，很不幸的是 Pascal / C 家族的语言往往很复杂<strong>而且在变得更复杂</strong>，例外的是 Go 语言很克制，但 Golang 的表达能力很弱，可谓开历史倒车，而简洁有力的 Lisp、Smalltalk、APL、Forth 在语法风格上一概不讨喜，微软的试验性语言 <a href=https://koka-lang.github.io/koka/doc/index.html>Koka</a> 强调 Minimal but General，实在是一股清流；</p></li><li><p>在类型系统上，2025 年了，静态强类型加类型推导俨然是主流了，连 C++ 这种老古董也加了一点类型推导能力；</p></li><li><p>在编程范式上，一切皆表达式的函数式编程已经是高精尖的代名词了；</p></li><li><p>在语言扩展性上，宏语法和常规语法应该是同构的，类型和变量应该是同构的；</p></li><li><p>在语言实现上，应该能融合语言实现和常规程序（也是一种同构），使得语言的使用者也能一定程度的改进语言，不必事事等语言设计者，也就是 Guy Steel 的 Growing a language 的核心观点；</p></li><li><p>在正确性验证上，实践基于「柯里-霍华德同构」的形式化证明应是语言设计和实现的终极追求；</p></li></ol><hr><h2 id=purelang>PureLang</h2><p>上面扯了一些有的没的，比较抽象，下面以一种假想的语言来具象化，我称这门语言为 PureLang，一门<strong>纯粹</strong>的编程语言，其语法跟 Smalltalk 类似可以写在一张明信片大小的纸上。</p><h3 id=语法>语法</h3><p>所有语言的语法离不开三个概念：变量、函数、类型，分别对应了数据、代码、数据结构。操作符、控制结构都可以认为是特殊的函数。</p><p>PureLang 的语法可谓「披着 C 皮但有着 Lisp 心」，本质就是 Lisp 的 S-exp ，但为了适应主流的 C 代码风格喜好做了一点伪装，很特别的是这个语言<strong>没有关键字</strong>，以下是一些示例，所有的语句要么是字面量或符号，要么是函数调用。</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># &#34;#&#34; 是注释开始，&#34;;&#34; 是 statement 结束，最后一个 statement 可以省略分号</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 等价 define_and_assign(a: Int,`+`(3, 4))</span>
</span></span><span style=display:flex><span>a: Int :<span style=color:#666>=</span> <span style=color:#40a070>3</span> + 4;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># b 的类型自动推导出来，等价 define_and_assign(b, `+`(3, 4))</span>
</span></span><span style=display:flex><span>b :<span style=color:#666>=</span> <span style=color:#40a070>3</span> + 4;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 等价 assign(a, `+`(5, 6))，这里用反引号避免歧义，也增加了可读性</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> <span style=color:#4070a0>`</span>+<span style=color:#4070a0>`</span><span style=color:#666>(</span>5, 6<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># if 是个特殊函数</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>if</span><span style=color:#666>(</span>a &gt; 10, 100, -100<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># block 也是个表达式，block 在函数参数里是 call by name 语义</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>if</span><span style=color:#666>(</span>a &gt; 10, <span style=color:#666>{</span> a + a <span style=color:#666>}</span>, <span style=color:#666>{</span> a * a<span style=color:#666>})</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># while 是个特殊函数，这里丢弃了它的返回值，注意 while 末尾要加分号，</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 注意 block 在函数参数里是 call by name 语义</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>while</span><span style=color:#666>({</span> a &lt; <span style=color:#40a070>20</span> <span style=color:#666>}</span>, <span style=color:#666>{</span>
</span></span><span style=display:flex><span>    println<span style=color:#666>(</span>fmt<span style=color:#666>(</span><span style=color:#4070a0>&#34;a = {a}&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>    ++a
</span></span><span style=display:flex><span><span style=color:#666>})</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># multi-method 语义，注意末尾要加分号</span>
</span></span><span style=display:flex><span>f :<span style=color:#666>=</span> <span style=color:#666>(</span>i: <span style=color:#bb60d5>Int</span> <span style=color:#666>=</span> 10, j: <span style=color:#bb60d5>Int</span> <span style=color:#666>=</span> 20<span style=color:#666>)</span> Int <span style=color:#666>{</span> i + j <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># multi-method 语义，省略了函数返回类型，可以自动推导出来</span>
</span></span><span style=display:flex><span>f :<span style=color:#666>=</span> <span style=color:#666>(</span>i: <span style=color:#bb60d5>Double</span> <span style=color:#666>=</span> 1.0, j: <span style=color:#bb60d5>Double</span> <span style=color:#666>=</span> 2.0<span style=color:#666>)</span> <span style=color:#666>{</span> i + j <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 两个参数都是默认值，因为返回值是 Int 类型，所以调用了整数加法</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> f<span style=color:#666>()</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># j 用了默认值</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> f<span style=color:#666>(</span>10<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 命名参数</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> f<span style=color:#666>(</span><span style=color:#bb60d5>j</span> <span style=color:#666>=</span> 30, <span style=color:#bb60d5>i</span> <span style=color:#666>=</span> 20<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 两个参数都显式指定</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>a</span> <span style=color:#666>=</span> f<span style=color:#666>(</span>100, 200<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 因为参数是 Double 类型，所以调用了浮点数加法，d 的类型自动推导出来</span>
</span></span><span style=display:flex><span>d :<span style=color:#666>=</span> f<span style=color:#666>(</span>5.0, 6.0<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 赋值会清除之前的 multi-method 定义</span>
</span></span><span style=display:flex><span><span style=color:#bb60d5>f</span> <span style=color:#666>=</span> <span style=color:#4070a0>`</span>+<span style=color:#4070a0>`</span>;
</span></span></code></pre></div><p>上面的语法可以总结成三条：</p><ol><li><p>定义和赋值变量，lambda 可以作为值赋值给变量；</p></li><li><p>调用 lambda，也就是调用函数，操作符只是函数的语法糖；</p></li><li><p>定义 lambda</p></li></ol><p>本质上第一条语法就是第二条，也就是说跟 Lisp 一样，一切非原子值都是如下形式的 S-exp：</p><pre tabindex=0><code>Callable(Expr | Identifier | &lt;Identify: Type&gt; | &lt;Identifier[: Type] = Expr&gt;, ...)
</code></pre><p>第三条稍微特殊点，其实也就是个特殊函数<code>lambda</code> 的语法糖：</p><pre tabindex=0><code>(Identifier [[: Type] = Expr], ...) [Type] BLOCK
</code></pre><p>以上就是 PureLang 的全部语法了，加上数字、字符串等字面量的无需多言的语法，用一张明信片写都缀缀有余，PureLang 对应其它语言的语法是用 S-exp 的<strong>语义</strong>和<strong>自定义操作符</strong>实现的，但有的语法肯定实现不了，那么解决办法是：不支持！其实回顾汇编语言就可以看到数据加函数就足够了，类型都不是必需的，形形色色的语法和类型一是提供表达的便利，二是增强对语义的约束从而提高正确性，良好的语法设计要在语法的表达便利、正确约束和繁复程度之间权衡，既不能太基本而陷入机器的细节，又不能太高级而陷入语法的细节。</p><h3 id=类型>类型</h3><p>上面讲了变量和函数的语法，提到 PureLang 没有关键字，那 <code>Int </code>和 <code>Double</code> 怎么来的呢？其实类型跟变量没太大区别，类型主要是编译期用的「数据」，而变量主要是运行期用的「数据」，说「主要」是因为有跨界：C++ 的 RTTI、Java 和 Go 的反射就是类型跑到运行期，C++ 的 constexpr 就是变量跑到编译期。PureLang 中的类型跟变量的语法是一样的，也就是说<strong>二者是同构的</strong>，下面是一些列子：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 与 NodeJS 类似，模块的值是一个结构体</span>
</span></span><span style=display:flex><span>std :<span style=color:#666>=</span> import<span style=color:#666>(</span><span style=color:#4070a0>&#34;std&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># &#34;.&#34; 是个操作符，获取结构体成员</span>
</span></span><span style=display:flex><span>Int :<span style=color:#666>=</span> std.types.Integer;
</span></span><span style=display:flex><span>Double :<span style=color:#666>=</span> std.types.Double;
</span></span><span style=display:flex><span>String :<span style=color:#666>=</span> std.types.String;
</span></span><span style=display:flex><span>Void :<span style=color:#666>=</span> std.types.Void;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># ProductType() 函数定义了一个结构体</span>
</span></span><span style=display:flex><span>User :<span style=color:#666>=</span> std.types.ProductType<span style=color:#666>(</span>name: <span style=color:#bb60d5>String</span> <span style=color:#666>=</span> <span style=color:#4070a0>&#34;Jack&#34;</span>, age: <span style=color:#bb60d5>Int</span> <span style=color:#666>=</span> 20<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 一个全局函数</span>
</span></span><span style=display:flex><span>greet :<span style=color:#666>=</span> <span style=color:#666>(</span>user: User<span style=color:#666>)</span> Void <span style=color:#666>{</span> println<span style=color:#666>(</span>user.name + fmt<span style=color:#666>(</span><span style=color:#4070a0>&#34; with age {user.age}&#34;</span><span style=color:#666>))</span> <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 类似 Scala、Python 的类，结构体名字本身是个 constructor 函数</span>
</span></span><span style=display:flex><span>you :<span style=color:#666>=</span> User<span style=color:#666>(</span><span style=color:#bb60d5>name</span> <span style=color:#666>=</span> <span style=color:#4070a0>&#34;You&#34;</span>, <span style=color:#bb60d5>age</span> <span style=color:#666>=</span> 30<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 调用函数</span>
</span></span><span style=display:flex><span>greet<span style=color:#666>(</span>you<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 方法和函数是统一的，obj.method(arg) 等价 method(obj, arg) </span>
</span></span><span style=display:flex><span>you.greet<span style=color:#666>()</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 可能的范型设计</span>
</span></span><span style=display:flex><span>sum :<span style=color:#666>=</span> <span style=color:#666>(</span>a: std.types.Array<span style=color:#666>)</span> Int <span style=color:#666>{</span> ... <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>a :<span style=color:#666>=</span> std.types.Array<span style=color:#666>(</span><span style=color:#007020>type</span> <span style=color:#666>=</span> Int, <span style=color:#bb60d5>size</span> <span style=color:#666>=</span> 32<span style=color:#666>)</span>; 
</span></span><span style=display:flex><span>a<span style=color:#666>(</span>0<span style=color:#666>)</span> <span style=color:#666>=</span> 0;    <span style=color:#60a0b0;font-style:italic># 类似 Scala，数组本身是个 Callable，表示索引</span>
</span></span><span style=display:flex><span>a<span style=color:#666>(</span>1<span style=color:#666>)</span> <span style=color:#666>=</span> 1;
</span></span><span style=display:flex><span>println<span style=color:#666>(</span>sum<span style=color:#666>(</span>a<span style=color:#666>))</span>
</span></span></code></pre></div><p>上面的类型以及构造类型的函数都在编译期求值，本质是在操作符号表和抽象语法树 ，编译器的行为是「标记为无副作用的函数以及仅调用这些函数的函数都被求值，直到不能再求值」，这有点像编译器的常量表达式消除，类似 C++ constexpr、Lisp macro 和 Zig comptime，达到编译期的语法和运行期的语法一致（很不幸 Zig 搞了个 comptime 关键字从而不是完全同构），并通过暴露符号表和抽象语法树、编译阶段的 API，进一步达到编译器的代码和用户应用的代码浑然一体：语言的用户也能参与语言的实现，比如实现更好的类型检查，这就是上面目标里的第 5、6 两点，而有了这两点，用户也能参与第 7 个目标的实现，至此，7 个目标都涵盖了，虽然假想的 API 还不成熟，但可以看到并不需要很复杂的语法。</p><h3 id=操作符>操作符</h3><p>PureLang 支持类似 Scala 的<a href=https://docs.scala-lang.org/tour/operators.html#precedence>自定义操作符</a>，以弥补一定的语法糖，达到主流语言的一些便利语法，代码示例如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># `-&gt;`(k, v) 构造一个 Pair 实例</span>
</span></span><span style=display:flex><span>m :<span style=color:#666>=</span> std.Map<span style=color:#666>(</span><span style=color:#40a070>1</span> -&gt; 2, <span style=color:#40a070>3</span> -&gt; 4<span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 精确小数运算</span>
</span></span><span style=display:flex><span>a :<span style=color:#666>=</span> Decimal<span style=color:#666>(</span><span style=color:#4070a0>&#34;1.3&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>b :<span style=color:#666>=</span> Decimal<span style=color:#666>(</span><span style=color:#4070a0>&#34;2.7&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>c :<span style=color:#666>=</span> a * b;
</span></span></code></pre></div><h3 id=惰性求值>惰性求值</h3><p>Haskell 是最著名的惰性求值函数式编程语言之一，在 Haskell 中，所有的计算都是惰性执行的，这意味着除非一个表达式的值被实际需要，否则不会进行计算，这使得 Haskell 在处理无限列表和其他复杂数据结构时特别强大，但是实践证明这个设计导致理解代码性能问题很头大。Scala 语言则用关键字 <code>lazy</code> 引入了显式的惰性求值，在 PureLang 中默认是立即求值，只有当函数参数中的 block 才是惰性求值，这是为了方便实现带有条件执行语义的函数，如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 两个 println() 在进入 if() 之前就被执行了</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>if</span><span style=color:#666>(</span><span style=color:#40a070>2</span> &gt; 1, println<span style=color:#666>(</span><span style=color:#4070a0>&#34;larger&#34;</span><span style=color:#666>)</span>, println<span style=color:#666>(</span><span style=color:#4070a0>&#34;smaller&#34;</span><span style=color:#666>))</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 两个 println() 在 if() 内部条件执行</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>if</span><span style=color:#666>(</span><span style=color:#40a070>2</span> &gt; 1, <span style=color:#666>{</span> println<span style=color:#666>(</span><span style=color:#4070a0>&#34;larger&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>, <span style=color:#666>{</span> println<span style=color:#666>(</span><span style=color:#4070a0>&#34;smaller&#34;</span><span style=color:#666>)</span> <span style=color:#666>})</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 等价 `||`(2 &gt; 1, println(&#34;smaller&#34;))，因此会输出 &#34;smaller&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40a070>2</span> &gt; <span style=color:#40a070>1</span> <span style=color:#666>||</span> println<span style=color:#666>(</span><span style=color:#4070a0>&#34;smaller&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 等价 `||`(2 &gt; 1, { println(&#34;smaller&#34;) })，因此不会输出 &#34;smaller&#34;</span>
</span></span><span style=display:flex><span><span style=color:#40a070>2</span> &gt; <span style=color:#40a070>1</span> <span style=color:#666>||</span> <span style=color:#666>{</span> println<span style=color:#666>(</span><span style=color:#4070a0>&#34;smaller&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f :<span style=color:#666>=</span> <span style=color:#666>(</span>i: Int<span style=color:#666>)</span> <span style=color:#666>{</span> println<span style=color:#666>(</span>i<span style=color:#666>)</span>; println<span style=color:#666>(</span>i<span style=color:#666>)</span> <span style=color:#666>}</span>;
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># a 会在 f() 里累加两次</span>
</span></span><span style=display:flex><span>f<span style=color:#666>({</span> ++a <span style=color:#666>})</span>;
</span></span></code></pre></div><p>这个特性等价于 Scala 的 <a href=https://docs.scala-lang.org/tour/by-name-parameters.html>call by name</a>，不同的是在调用函数时表达，而不是在函数定义时，这个设计很像 Mathematica 的 <a href=https://reference.wolfram.com/language/ref/Unevaluated.html>Unevaluated</a>，这样设计有两个原因：</p><ol><li><p>避免引入类似 Common Lisp 中 <code>if</code> 等 special form 的参数求值特殊规则，PureLang 的 block 作为 call by name 语义是通用的；</p></li><li><p>阅读代码时可以清晰看到 call by name 语义，而无需像 Common Lisp 那样要看文档，也无需像 Scala 那样要看函数签名，Rust 语言的 <code>mut</code> 在调用函数时也要写上，原因也是为了代码可读性。</p></li></ol><p>但这种设计有个缺陷，由于函数在声明时没想到会被按 call by name 方式传参，导致参数在函数内部被无意中重复求值而引起重复的副作用，所以这个特性还是要小心使用。其实所有语言都支持一种显式的惰性计算，就是把计算封入闭包里，但这会导致语法有点难看：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 用闭包实现延迟计算，但这个很丑，而且 while_with_closure() 内部</span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic># 要用 closure() 而非 expr 来使用参数，也很丑</span>
</span></span><span style=display:flex><span>while_with_closure<span style=color:#666>(</span> <span style=color:#666>(){</span> a &gt; 0<span style=color:#666>}</span>,  <span style=color:#666>(){</span> --a; println<span style=color:#666>(</span>a<span style=color:#666>)</span> <span style=color:#666>})</span>;
</span></span></code></pre></div><h3 id=编译>编译</h3><p>词法分析、语法分析、语义分析（包含构造符号表、抽象语法树、类型检查）、编译期执行、目标代码生成，这一套下来细节很多，但由于同构的设计，也许在模仿《<a href=http://daiyuwen.freeshell.org/gb/rol/roots_of_lisp.html>Lisp 之根源</a>》实现一个解释器核后，所有逻辑都可以用 PureLang 自身实现了（依赖解释器宿主的一些能力，比如 I/O、内存分配)，进一步可以实现自举的伟大复兴！</p><p>关于目标代码生成，PureLang 应该以 Go、C/C++、JavaScript、Java 为目标，以利用这些语言的编译器优化和库生态。</p><h3 id=内存管理>内存管理</h3><p>PureLang 的最大愿望是减轻程序员的心智负担，提供类似 Lisp SLIME、Smalltalk IDE 的「可塑开发(moldable development)」乐趣，因为目标语言多为带 GC 的语言，因此 PureLang 会使用 GC 技术以免除程序员手工管理内存的痛苦。</p><h3 id=lsp>LSP</h3><p>由于 PureLang 在编译期可以执行代码，因此是不方便用简单的 Ctags 之类工具跳转符号的，而恰好 PureLang 的编译器本身内置了解释器，正好可以用来实现 LSP server。</p><hr><h2 id=结语>结语</h2><p>PureLang 是个假想的语言，可能永远都不会实现出来，用 PureLang 「貧瘠」的语法可能也不太方便直观的表达主流编程语言的一些高级特性，如 Generic、Trait、Pattern Match、Annotation，但是，一个程序员对完美编程语言没有梦想，那跟咸鱼有什么分别呢？在这个巨头横行把持主流语言发展、不断语法复杂化的世界，用最简洁的语法糖表达最高级的语言设计，本身就是一个充满乐趣的挑战。</p></div></div></div><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div></div><div class="footer pure-g"><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div><div class="pure-u-11-12 pure-u-md-20-24 pure-u-lg-7-12"><div class=footer-content><div class="pure-menu pure-menu-horizontal"><ul><li class=pure-menu-item id=foot-name>© Yubao Liu</li></ul><a href=# class="pure-menu-link pull-right" id=gototop-btn>↑↑</a></div></div></div><div class="pure-u-1-24 pure-u-md-2-24 pure-u-lg-5-24"></div></div><script type=text/javascript>go(),window.addEventListener("resize",go);function go(){var e=document.querySelector(".desktop");document.documentElement.clientWidth>768?e.style.display="":e.style.display="none"}</script><script type=text/javascript>var a=document.querySelector("#toggle-btn"),b=document.querySelector("#toggle-content");a.addEventListener("click",function(){""==b.style.display?(b.style.display="none",a.innerHTML="☰"):(b.style.display="",a.innerHTML="X")})</script></body></html>